<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home_NormalUser</title>
    <link rel="stylesheet" href="statics/css/Home.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="statics\js\loadBoostrap.js" defer></script>
</head>
<body>
    <!-- ActivityList -->
    <div id="head" class="Tophead d-flex flex-row align-items-center p-2">
        <div class="col-1 d-flex justify-content-center">
            <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#AnnounceBoard">
                <iconify-icon icon="mdi:bell"  style="color:#9747ff;" width="40" height="40"></iconify-icon>
            </button>
        </div>
        <div class="col-10 d-flex justify-content-center">
            <div class="col-2 p-1"><a href="Module_7.0/Friends.html" class="btn btn-primary btn-lg mb-3" style="width: 100%; height: auto;background-color: lightseagreen; border-radius: 100%;">好友</a></div>
            <div class="col-2 p-1"><a href="Module_2.0/Account_Management.html" class="btn btn-primary btn-lg mb-3" style="width: 100%; height: auto;background-color: darkblue; border-radius: 100%;">帳號</a></div>
            <div class="col-2 p-1"><a href="Module_3.0/Activity_Mangement.html" class="btn btn-primary btn-lg mb-3" style="width: 100%; height: auto;background-color: darkgoldenrod; border-radius: 100%;">管理活動</a></div>
            <div class="col-2 p-1"><a href="Module_5.0/Organization_Management.html" class="btn btn-primary btn-lg mb-3" style="width: 100%; height: auto;background-color: brown; border-radius: 100%;">組織</a></div>
            <div class="col-2 p-1"><a href="Module_6.0/Store.html" class="btn btn-primary btn-lg mb-3" style="width: 100%; height: auto;background-color: purple; border-radius: 100%;">商城</a></div>
            <div class="col-2 p-1"><a href="Module_8.0/Supervise.html" class="btn btn-primary btn-lg mb-3" style="width: 100%; height: auto;background-color: rgb(212, 3, 3); border-radius: 100%;">管理審查</a></div>
        </div>
        <div class="col-1 d-flex flex-column justify-content-center align-items-center">
            <span>UserName</span>
            <span>UserID</span>
        </div>
    </div>
    <div id="activityList" class="container-fluid d-grid p-2">
        <table id="activityTable" class="table table-striped">
            <thead>
                <tr>
                    <th>活動名稱</th>
                    <th>活動類型</th>
                    <th>活動舉辦人</th>
                    <th>活動地點</th>
                    <th>日期</th>
                    <th>時間</th>
                    <th>目前參與人數</th>
                    <th>活動人數上限</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>SA分享會</td>    
                    <td>系級活動</td>
                    <td>xxx</td>
                    <td>017教室</td>
                    <td>2020/12/29</td>
                    <td>13:00-18:00</td>
                    <td>120</td>
                    <td>無</td>
                    <td>
                        <div class="btn-group d-flex" role="group">
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#ActivityDetail">詳細內容</button>
                            <button class="Join_Button btn btn-primary btn-sm" style="background-color:rgb(0, 180, 0)">參加</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>    

    <!-- Activity Detail Interface -->
    <div class="modal fade modal-dialog modal-lg" id="ActivityDetail" tabindex="-1" aria-labelledby="ActivityDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="max-height: 700px;">
                <div class="modal-header" style="display: flex;justify-content:space-between ;align-items: center;">
                    <button id="AttenButtn" class="btn btn-primary btn-lg" style="background-color:rgb(0, 180, 0)">參加</button>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="btn"><iconify-icon icon="iph:heart-bold" style="color:rgb(198, 218, 20)" width="50" height="50"></iconify-icon></button>
                        <button type="button" class="btn"><iconify-icon icon="icon-park-outline:people-bottom" style="color:rgb(156, 202, 31);" width="50" height="50"></iconify-icon></button>
                        <button type="button" class="btn"><iconify-icon icon="ant-design:message-twotone" style="color:rgb(67, 160, 223);" width="50px" height="50"></iconify-icon></button>
                        <button type="button" class="btn"><iconify-icon icon="zondicons:exclamation-solid" style="color:rgb(207, 61, 61);" width="50" height="50"></iconify-icon></button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="width: 50; height: 50; background-color: aliceblue;"></button>
                    </div>
                </div>
                <div class="modal-body" style="overflow-y: scroll; word-wrap: break-word;max-height:fit-content;">
           <div class="modal-content" style="max-height: 700px;">
                <div class="modal-header" style="display: flex;justify-content:space-between ;align-items: center;">
                    <button id="AttenButtn" class="btn btn-primary btn-lg" style="background-color: gray;">參加</button>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="btn"><iconify-icon icon="iph:heart-bold" style="color:gray" width="50" height="50"></iconify-icon></button>
                        <button type="button" class="btn"><iconify-icon icon="icon-park-outline:people-bottom" style="color:gray;" width="50" height="50"></iconify-icon></button>
                        <button type="button" class="btn"><iconify-icon icon="ant-design:message-twotone" style="color:gray;" width="50px" height="50"></iconify-icon></button>
                        <button type="button" class="btn"><iconify-icon icon="zondicons:exclamation-solid" style="color:gray;" width="50" height="50"></iconify-icon></button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="width: 50; height: 50; background-color: aliceblue;"></button>
                    </div>
                </div>
                <div class="modal-content" style="max-height: 700px;">
                    <div class="modal-header" style="display: flex;justify-content:space-between ;align-items: center;">
                        <button id="AttenButtn" class="btn btn-primary btn-lg" style="background-color: gray;">參加</button>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button type="button" class="btn"><iconify-icon icon="iph:heart-bold" style="color:gray" width="50" height="50"></iconify-icon></button>
                            <button type="button" class="btn"><iconify-icon icon="icon-park-outline:people-bottom" style="color:gray;" width="50" height="50"></iconify-icon></button>
                            <button type="button" class="btn"><iconify-icon icon="ant-design:message-twotone" style="color:gray;" width="50px" height="50"></iconify-icon></button>
                            <button type="button" class="btn"><iconify-icon icon="zondicons:exclamation-solid" style="color:gray;" width="50" height="50"></iconify-icon></button>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="width: 50; height: 50; background-color: aliceblue;"></button>
                        </div>
                    </div>
                    <div class="modal-body" style="overflow-y: scroll; word-wrap: break-word;max-height:fit-content;">
                        <div id="ActivitiesInformation_Modal" class="ActivitiesInformation">
                            <div class="activity-detail-content">
                              <span class="detail-label">活動名稱：</span>
                              <span id="activity_title" class="detail-value">{{activity_title}}</span>
                            </div>
                            <div class="activity-detail">
                                <span class="detail-label">發布型別：</span>
                                <span id="activity_publish_type" class="detail-value">{{activity_publish_type}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動類型：</span>
                              <span id="activity_type" class="detail-value">{{activity_type}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動發起人：</span>
                              <span id="activity_publisher_id" class="detail-value">{{activity_publisher_id}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動日期：</span>
                              <span id="start_date" class="detail-value">{{start_date}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動時間：</span>
                              <span id="Time" class="detail-value">{{Time}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動地點：</span>
                              <span id="activity_location" class="detail-value">{{activity_location}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">目前參與人數：</span>
                              <span id="participant_number" class="detail-value">{{participant_number}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動人數下限：</span>
                              <span id="minimum_participant" class="detail-value">{{minimun_participant}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動人數上限：</span>
                              <span id="maximum_participant" class="detail-value">{{maximum_participant}}</span>
                            </div>
                            <div class="activity-detail">
                              <span class="detail-label">活動內容：</span>
                              <span id="activity_detail" class="detail-value">{{activity-detail}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">確認</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">確認</button>
                </div>
            </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">確認</button>
                </div>
            </div>
        </div>
    </div>

    <!-- CommentBoard -->
    <div class="modal fade modal-dialog modal-lg" id="CommentBoard" tabindex="-1" aria-labelledby="ActivityDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="max-height: 700px;">
                <div class="modal-header" style="display: flex;justify-content:space-between ;align-items: center; background-color: black;">
                    <button class="Join_Button btn btn-primary btn-lg" style="background-color: rgb(0, 180, 0);">參加</button>
                    <span style="align-items: center; color: #FFC700;font-size: xx-large;">留言板</span>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="width: 50; height: 50; background-color: aliceblue;"></button>
                    </div>
                </div>
                <div class="modal-body" style="overflow-y: scroll; word-wrap: break-word;max-height:fit-content;">
                    <div class="container row" style="display: flex;">
                        <div id="allComment" class="row col-12">
                            <strong>北風一笑：</strong>
                            <span>00:00</span>
                            <span class="mb-2">這個期末專題要死人啦！</span>
                            <strong>南柯一夢：</strong>
                            <span>00:00</span>
                            <span class="mb-2">這個期末專題要死人啦！</span>
                            <strong>西金一下：</strong>
                            <span>00:00</span>
                            <span class="mb-2">這個期末專題要死人啦！</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer col-12">
                    <textarea name="YourComment" id="YourComment" cols="30" rows="1" placeholder="請輸入訊息......" style="width: 80%;"></textarea>
                    <button type="submit" class="btn btn-secondary" data-bs-dismiss="modal">送出</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ReportBoard -->
    <div class="modal fade modal-dialog modal-lg" id="ReportBoard" tabindex="-1" aria-labelledby="ActivityDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="max-height: 700px;">
                <div class="modal-header" style="display: flex;justify-content:space-between ;align-items: center; background-color: black;">
                    <button class="Join_Button btn btn-primary btn-lg" style="background-color: rgb(0, 180, 0);">參加</button>
                    <span style="align-items: center; color: #FFC700;font-size: xx-large;">檢舉內容</span>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="width: 50; height: 50; background-color: aliceblue;"></button>
                    </div>
                </div>
                <div class="modal-body d-flex flex-column justify-content-center align-items-center" style="overflow-y: scroll; max-height: fit-content;">
                    <label for="ReportReason" class="form-label">檢舉原因：</label>
                    <textarea name="ReportReason" id="ReportReason" cols="30" rows="10" placeholder="請輸入檢舉內容......"></textarea>
                </div>                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">提交</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Announce Board -->
    <div class="modal fade modal-dialog modal-lg" id="AnnounceBoard" tabindex="-1" aria-labelledby="ActivityDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="max-height: 700px;">
                <div class="modal-header" style="display: flex;justify-content:space-between ;align-items: center; background-color: black;">
                    <span style="align-items: center; color: #FFC700;font-size: xx-large;">通知欄</span>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="width: 50; height: 50; background-color: aliceblue;"></button>
                    </div>
                </div>
                <div class="modal-body" style="overflow-y: scroll; max-height: fit-content;">
                    <div class="card" style="width: 100%; color: #00656B;">
                        <button id="Notification_ID" class="btn card-body">
                            <h5 id="NotificationTitle" class="card-title">全校活動大會</h5>
                            <hr class="Line6" style="border: 3px #043437 solid;">
                            <p id="NotificationContent" class="text-muted">
                                這是一個帶有淡灰色的段落文字。這是一個帶有淡灰色的段落文字。
                            </p>
                        </button>
                        <button class="btn card-body">
                            <h5 class="card-title">全校活動大會</h5>
                            <hr class="Line6" style="border: 3px #043437 solid;">
                        </button>
                        <button class="btn card-body">
                            <h5 class="card-title">全校活動大會</h5>
                            <hr class="Line6" style="border: 3px #043437 solid;">
                        </button>
                    </div>
                </div>                
            </div>
        </div>
    </div>
</body>
<script>
    var Join_Button = document.getElementById("Join_Button");
    Join_Button.addEventListener("click", function(){
    if(Join_Button.style["backgroundColor"] === "rgb(0, 180, 0)"){
        Join_Button.style.backgroundColor = "#D91621";
    } else{
        Join_Button.style.backgroundColor = "#00B400";
    }
    });
    // 獲取所有擁有 class="Join_Button" 的按鈕
    var Join_Buttons = document.querySelectorAll(".Join_Button");
    Join_Buttons.forEach(function(Join_Button) {
        Join_Button.addEventListener("click", function() {
            // 獲取元素的背景顏色
            var computedStyle = window.getComputedStyle(Join_Button);
            var backgroundColor = computedStyle.backgroundColor;
            // 判斷元素的背景顏色，進行相應的操作
            if (backgroundColor === "rgb(0, 180, 0)" || backgroundColor === "#00B400") {
                Join_Buttons.forEach(function(button) {
                    button.style.backgroundColor = "#D91621";

                });
            } else {
                Join_Buttons.forEach(function(button) {
                    button.style.backgroundColor = "#00B400";
                });
            }
        });
    });

    window.onload = function () {
    // 等文檔加載完畢後，再執行這個函數
        getAllActivity();
	};
    function getAllActivity() {
        // 發出POST的GET請求取得所有會員列表
        $.ajax({
                type: "GET",
                url: "api/ActivityController.do",
                crossDomain: true,
                cache: false,
                dataType: 'json',
                timeout: 5000,
                success: function (response) {
                    if(response.status == 200){
                        updateActivityTable(response.response.data);
                            // 監聽活動詳細內容按鈕的點擊事件
                            $(".activity-detail-btn").on("click", function() {
                                // 獲取按鈕上的活動ID
                                var activityId = $(this).attr("id");
                                // 直接在這裡處理模態框內容更新，不需要再發送請求
                                var activityDetail = getActivityDetailById(response.response.data, activityId);
                                updateActivityModalContent(activityDetail);
                                // 顯示模態框
                                $("#ActivityDetail").modal("show");
                        });
                    }
                    console.log(response.response.data);
                },
                error: function () {
                    alert("無法連線到伺服器！");
                }
        });
    }
    // 根據活動ID從資料中獲取詳細內容
    function getActivityDetailById(data, activityId) {
        var result = null;
        var breakLoop = false;
        $.each(data, function(index, value) {
			console.log("value['id']: " + value['id']);
        	console.log("activityId: " + activityId);
            if (value['id'] === parseInt(activityId) && breakLoop === false) {
                console.log("Match found:");
                result = value;
                console.log(value["id"]);
                console.log(activityId);
                console.log(result);
                breakLoop = true;
            }
        });
        return result;
    }
    
    function updateActivityTable(data) {
        $("#activityTable > tbody").empty();
        var table_html = '';
        $.each(data, function(index, value) {
            table_html += '<tr>';
            table_html += '<td>' + value['activity_name'] + '</td>';
            table_html += '<td>' + value['activity_type'] + '</td>';
            table_html += '<td>' + value['activity_publisher_id'] + '</td>';
            table_html += '<td>' + value['activity_place'] + '</td>';
            table_html += '<td>' + value['start_date'] + '</td>';
            table_html += '<td>' + value['start_time'] + '-' + value['end_time'] + '</td>';             
            table_html += '<td>' + value['activity_participant'] + '</td>';
            table_html += '<td>' + value['maximum_participant'] + '</td>';    
            table_html += '<td><div class="btn-group d-flex" role="group">';
            table_html += '<button type="button" class="activity-detail-btn btn btn-primary btn-sm" id = "'+ value['id'] + '">' +'詳細內容</button>';
            table_html += '<button class="btn btn-primary btn-sm" style="background-color: gray;">參加</button>';
            table_html += '</div></td>';
            table_html += '<tr>';
        })
        $("#activityTable > tbody").append(table_html);
    }

    // 更新活動詳細資訊模態框內容
    function updateActivityModalContent(activityDetail) {
        // 在這裡更新模態框內容，例如：
        $("#activity_title").text(activityDetail.activity_name);
        $("#activity_publish_type").text(activityDetail.activity_status);
        $("#activity_type").text(activityDetail.activity_type);
        $("#activity_publisher_id").text(activityDetail.activity_publisher_id);
        $("#start_date").text(activityDetail.start_date);
        $("#Time").text(activityDetail.start_time+"-"+activityDetail.end_time);
        $("#activity_location").text(activityDetail.activity_place);
        $("#participant_number").text(activityDetail.activity_participant);
        $("#minimum_participant").text(activityDetail.minimum_participant);
        $("#maximum_participant").text(activityDetail.maximum_participant);
        $("#activity_detail").text(activityDetail.activity_detail);

        // ...（更新其他詳細內容）
    }
</script>
</html>