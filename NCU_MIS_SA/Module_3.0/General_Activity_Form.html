<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General Activity Form</title>
    <link rel="stylesheet" href="../statics/css/Home.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="../statics/js/loadBoostrap.js" defer></script>
</head>
<body>
    <div id="head" class="Tophead d-flex flex-row align-items-center p-2">
        <div class="col-1 d-flex justify-content-center">
            <button id="Home" class="btn"><iconify-icon icon="ant-design:home-filled" style="color: #9747ff;" width="50" height="50"></iconify-icon></button>
            <button id="reback" class="btn"><iconify-icon icon="material-symbols:keyboard-return-rounded" style="color: #9747ff;" width="40" height="40"></iconify-icon></button>
        </div>
        <div class="col-5 d-flex justify-content-center">
            <h2 style="color: yellow;">發布一般活動</h2>
        </div>
    </div>
    <div class="container-fluid p-2">
        <form id="GeneralActivityForm" action="">
            <div class="input-group mb-3 ">
                <label class="input-group-text" for="ActivityNameInput">活動名稱：</label>
                <input name="ActivityNameInput"  id="ActivityNameInput" type="text" class="form-control-p" placeholder="ex:請填入活動的名稱" aria-label="ActivityName" required>
            </div>
            <div class="input-group mb-3">
                <label class="input-group-text" for="FirstNameInput">活動發布型別：</label>
                <select name="PublishTypeInput" id="PublishTypeInput" class="form-select">
                    <option>一般活動</option>
                </select>
            </div>
            
            <div class="input-group mb-3">
                <label class="input-group-text" for="MaxMemberInput">活動人數上限：</label>
                <select name="disabledSelect" id="disabledSelect" class="form-select">
                    <option>校級活動</option>
                    <option>系級活動</option>
                    <option>社團活動</option>
                    <option>靜態休閒活動</option>
                    <option>動態休閒活動</option>
                    <option>其他</option>
                </select>
            </div>

            <div class="input-group mb-3">
                <label class="input-group-text" for="FirstNameInput">活動發起人：</label>
                <input name="PublisherInput" id="PublisherInput" type="text" class="form-control" placeholder="請填入您現在登入的使用者ID" aria-label="Publisher" required>
            </div>
            <div class="input-group mb-3">
                <label class="input-group-text" for="FirstNameInput">活動地點：</label>
                <input name="LocationInput" id="LocationInput" type="text" class="form-control" placeholder="請填入活動的舉辦地點" aria-label="Location" required>
            </div>
            <div class="input-group mb-3">
                <label class="input-group-text" for="FirstNameInput">活動人數下限：</label>
                <input name="MinMemberInput" id="MinMemberInput" type="text" class="form-control" placeholder="該活動最低需求人數是多少" aria-label="MinMember" required>
            </div>
            <div class="input-group mb-3">
                <label class="input-group-text" for="MaxMemberInput">活動人數上限：</label>
                <input name="MaxMemberInput" id="MaxMemberInput" type="text" class="form-control" placeholder="該活動最高可容納幾人參加" aria-label="MaxMember" required>
            </div>

            <div class="input-group date mb-3" data-provide="datepicker" data-target-input="nearest">
                <label class="input-group-text" for="StartDatePicker">活動開始日期：</label>
                <input name="StartDatePicker" id="StartDatePicker" type="text" class="form-control" placeholder="月/日/年" required>
                <div class="input-group-addon">
                    <span class="glyphicon glyphicon-th"></span>
                </div>
            </div>

            <div class="input-group mb-3">
                <label class="input-group-text" for="StartTimeInput">活動開始時間</label>
                <input name="StartTimeInput" id="StartTimeInput" type="text" class="form-control" placeholder="(24小時制) ex: 21:00" aria-label="StarTime" required>
            </div>

            <div class="input-group date mb-3" data-provide="datepicker">
                <label class="input-group-text" for="EndDatePicker">活動結束日期：</label>
                <input name="EndDatePicker" id="EndDatePicker" type="text" class="form-control" placeholder="月/日/年" required>
                <div class="input-group-addon">
                    <span class="glyphicon glyphicon-th"></span>
                </div>
            </div>

            <div class="input-group mb-3">
                <label class="input-group-text" for="EndTimeInput">活動結束時間</label>
                <input name="EndTimeInput"  id="EndTimeInput" type="text" class="form-control" placeholder="(24小時制) ex: 21:00" aria-label="EndTime" required>
            </div>

            <div class="input-group mb-3">
                <label class="input-group-text" for="ContentInput">活動內容：</label>
                <textarea name="Content" id="ContentInput" cols="100" rows="20" placeholder="請簡單描述您的活動" required></textarea>
            </div>
            <div class="col-md-12 p-0" >
                <button id="Submit" type="submit" class="btn btn-primary btn-lg mb-3" style="width:100% ;font-size:x-large; background-color:rgba(193, 17, 209, 0.856);">確認發布</button>
            </div>
        </form>
    </div>
</body>
<script>
    document.getElementById("Home").addEventListener("click", function() {
        // if(authication=="一般使用者"){

        // }
        // else{}
        window.location.href = "../HomeList_NormalUser.html";
    });
    document.getElementById("reback").addEventListener("click", function() {
        window.history.back();
    });
    //
    	$(document).ready(function(){
		$("#GeneralActivityForm").submit(function (e){
			e.preventDefault();
			formcheck();
			postevent();
		});
	    // get email input and verify the feedback element /獲取 email 輸入框和驗證反饋元素
	
	    // Submit data and check
	    function formcheck() {
	    	const ActivityNameInput = document.getElementById("ActivityNameInput");
	    	const PublishTypeInput = document.getElementById("PublishTypeInput");
	    	const disabledSelect = document.getElementById("disabledSelect");
			const PublisherInput = document.getElementById("PublisherInput");
		    const LocationInput = document.getElementById("LocationInput");
		    const MinMemberInput = document.getElementById("MinMemberInput");
		    const MaxMemberInput = document.getElementById("MaxMemberInput");
		    const StartDatePicker = document.getElementById("StartDatePicker");
		    const StartTimeInput = document.getElementById("StartTimeInput");
		    const EndDatePicker = document.getElementById("EndDatePicker");
		    const EndTimeInput = document.getElementById("EndTimeInput");
		    const ContentInput = document.getElementById("ContentInput");
		    //const StartTimeValidationFeedback = document.getElementById("StartTimeValidationFeedback");
	        //const EndTimeValidationFeedback = document.getElementById("EndTimeValidationFeedback");
	        // // Use regular expressions to verify the email format /使用正則表達式驗證 email 格式
	        //const Timepattern = /^\d{2}:\d{2}$/;
	        //let isValidStartTime = Timepattern.test(StartTimeInput.value);
	        //let isValidEndTime = Timepattern.test(EndTimeInput.value);
	
	        // // Update validation feedback /更新驗證反饋
	        //StartTimeValidationFeedback.style.display = isValidStartTime ? "none" : "block";
	        //EndTimeValidationFeedback.style.display = isValidEndTime ? "none" : "block";       
	        

	        // Check wether email is fit
	        //console.log(isValidStartTime);
	        //console.log(isValidEndTime);
	        //if(!isValidStartTime || !isValidEndTime ){
	            // stop submit behavior /阻止表單預設的提交行為
	        //    event.preventDefault();
	        //} else{
	        //    console.log("Yes");
	        //}
	    };
	    function postevent(){
	    	var activity_title = $('#ActivityNameInput').val();
	        var activity_publish_type = $('#PublishTypeInput').val();
	        var activity_type = $('#disabledSelect').val();
	        var activity_publisher_id = $('#PublisherInput').val();
	        var activity_location = $('#LocationInput').val();
	        var minimum_participant = $('#MinMemberInput').val();
	        var maximum_participant = $('#MaxMemberInput').val();
	        var start_date = $('#StartDatePicker').val();
	        var start_time = $('#StartTimeInput').val();
	        var end_date = $('#EndDatePicker').val();
	        var end_time = $('#EndTimeInput').val();
	        var activity_detail = $('#ContentInput').val();
	        var published_date = new Date().toLocaleDateString();
	        var published_time = new Date().toLocaleTimeString();
	        var participant_number = 0;

	        
	        
	        var Activity_form_data_object = {
	        	"activity_title": activity_title,
	        	"activity_publish_type": activity_publish_type,
	        	"activity_publisher_id": activity_publisher_id,
	            "activity_type": activity_type,
	            "activity_location": activity_location,
	            "maximum_participant": maximum_participant,
	            "minimum_participant": minimum_participant,
	            "start_date": start_date,
	            "start_time": start_time,
	            "end_date": end_date,
	            "end_time": end_time,
	            "activity_detail": activity_detail,
	            "published_date": published_date,
	            "published_time": published_time,
	            "participant_number": participant_number,
	        };
	        console.log(Activity_form_data_object);
	        var Activity_form_data_string = JSON.stringify(Activity_form_data_object);
			console.log(Activity_form_data_string);
	        
			$.ajax({
	            type: "POST",
	            url: "../api/ActivityController.do",
	            data: Activity_form_data_string,
	            crossDomain: true,
	            cache: false,
	            dataType: 'json',
	            timeout: 5000,
	            success: function (response) {
	                $('#flashMessage').html(response.message);
	                $('#flashMessage').show();
	            	if(response.status == 200){
	                	console.log("Yes");
	                	console.log(response.response);	
	                	console.log(Activity_form_data_string);	
	                	alert("Successfully published event");
	                	window.location.href = "Activity_Mangement.html";
	            	} else {
						alert("Unable to publish event");
					}
	            },
	            error: function () {
	                alert("無法連線到伺服器！");
	            }
	        })
	    }
	})
</script>
</html>